<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <title>Zillian Aquarium - Checkout</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="The Estate Teplate">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="{% static 'styles2/bootstrap4/bootstrap.min.css' %}">
    <link href="{% static 'plugins2/fontawesome-free-5.0.1/css/fontawesome-all.css' %}" rel="stylesheet"
        type="text/css">
    <link rel="stylesheet" type="text/css" href="{% static 'plugins2/OwlCarousel2-2.2.1/owl.carousel.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'plugins2/OwlCarousel2-2.2.1/owl.theme.default.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'plugins2/OwlCarousel2-2.2.1/animate.css' %}">
    <link href="{% static 'plugins2/magnific-popup/magnific-popup.css" rel="stylesheet" type="text/css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'styles2/listings_single_styles.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'styles2/listings_single_responsive.css' %}">


    <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/icofont/icofont.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/boxicons/css/boxicons.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/venobox/venobox.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/owl.carousel/assets/owl.carousel.min.css' %}" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <link href="{% static 'css1/store.css' %}" rel="stylesheet">
    <link href="{% static 'css1/cart.css' %}" rel="stylesheet">


    <style>
        body {
            font-family: "Open Sans", sans-serif;
            color: #444444;
        }
    </style>
</head>


<body>
    <header id="header" class="fixed-top">
        <div class="container d-flex align-items-center">

            <h1 class="logo mr-auto"><a style="font-size: x-large;" href="{% url 'aquarium' %}">Zillian Aquarium</a>
            </h1>
            <a href="{% url 'aquarium_cart' %}">
                <i style="color: #5f687b;" class="fa fa-shopping-cart icon-place cart">
                    <span style="top: 0px;" class="carttip">{{bagItemsA}}</span>
                </i>
            </a>
            <!-- Uncomment below if you prefer to use an image logo -->
            <!-- <a href="index.html" class="logo mr-auto"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->

            <nav class="nav-menu d-none d-lg-block">
                <ul>
                    <li><a href="/">ZillianWorld</a></li>
                    <li><a href="{% url 'homes' %}">Homes</a></li>
                    <li><a href="{% url 'store' %}">Store</a></li>
                    <li class="active"><a href="{% url 'aquarium' %}">Aquarium</a></li>
                </ul>
            </nav><!-- .nav-menu -->

        </div>
    </header>

    <section id="intro">
        <div class="intro-container">
            <div id="introCarousel" class="carousel  slide carousel-fade" data-ride="carousel">


                <div class="carousel-item active" style="background-image: url({% static 'img/five.jpeg' %}">
                    <div class="carousel-container">
                        <div class="container">
                            <section class="form-12" id="home">
                                <div class="form-12-content">
                                    <div class="container">
                                        <div class="grid grid-column-2 ">
                                            <div class="column2">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>


    <div class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__links">
                        <a href="{% url 'aquarium_cart' %}"><i class="fa fa-home"></i> Home</a>
                        <span>Checkout</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumb End -->



    <!-- Checkout Section Begin -->
    <section class="checkout spad">
        <div class="container">
            <form action="#" class="checkout__form" id="form">
                <div class="row">
                    <div class="col-lg-8">
                        <h5>Billing detail</h5>
                        <div class="row" id="shipping-info">
                            <div class="col-lg-6 col-md-6 col-sm-6">
                                <div class="checkout__form__input">
                                    <p> Name <span style="color: #16df7e;">*</span></p>
                                    <input name="name" id="name" type="text">
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6">
                                <div class="checkout__form__input">
                                    <p>Phone <span style="color: #16df7e;">*</span></p>
                                    <input name="phone" id="phone" type="text">
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6">
                                <div class="checkout__form__input">
                                    <input type="hidden" name="email" id="email" type="email">
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="checkout__form__input">
                                    <p>Address <span style="color: #16df7e;">*</span></p>
                                    <input name="streetAddress" type="text" placeholder="Street Address">
                                    <input name="apartmentAddress" type="text"
                                        placeholder="Apartment. suite, unite ect ( optinal )">
                                </div>
                                <div class="checkout__form__input">
                                    <p>Town/City <span style="color: #16df7e;">*</span></p>
                                    <input name="town" type="text">
                                </div>
                                <div class="checkout__form__input">
                                    <p>State <span style="color: #16df7e;">*</span></p>
                                    <input name="state" type="text">
                                </div>
                                <div class="checkout__form__input">
                                    <p>Postcode/Zip <span style="color: #16df7e;">*</span></p>
                                    <input name="zipcode" type="text">
                                </div>
                                <div class="checkout__form__input">
                                    <p>Unique code <span style="color: #16df7e;">*</span></p>
                                    <input name="code" id="code" type="text">
                                  </div>

                                  <div class="checkout__form__input">
                                    <input name="subtotal" id="subtotal" type="hidden" value="{{order.get_cart_total}}">
                                  </div>
                  
                                  <div class="checkout__form__input">
                                    <input name="total" id="total" type="hidden" value="">
                                  </div>



                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="checkout__order">
                        <h5>Your order</h5>
                        <div class="checkout__order__product">
                            <ul>
                                <li>
                                    <span class="top__text">Product</span>
                                    <span class="top__text__right">Total</span>
                                </li>
                                {% for item in items %}
                                <li>{{item.quantity}} {{item.product.name}}
                                    <span>₦{{item.get_total|floatformat:2}}</span></li>
                                {% endfor %}

                            </ul>
                        </div>
                        <div class="checkout__order__total">
                            <ul>
                                <li>Subtotal <span style="color: #16df7e;">₦
                                        {{order.get_bag_total|floatformat:2}}</span></li>
                                <li>Total <span style="color: #16df7e;">₦ {{order.get_bag_total|floatformat:2}}</span>
                                </li>
                            </ul>
                        </div>
                        <div class="checkout__order__total">
                            <ul>
                              <li>Subtotal <span style="color: #16df7e;">₦ {{order.get_cart_total}}</span></li>
                              <li><input id="pick" name="delivery" type="radio" onclick="Yourself()" checked> <label for="pick" style="font-size: small;"> Pickup yourself </label> <span style="float: right; color: #16df7e;">₦ 0</span> </li>

                              <li><input id="within" name="delivery" type="radio" onclick="DeliveryWithin()"> <label for="within" style="font-size: small;"> Delivery within Lagos </label> <span style="float: right; color: #16df7e;">₦ 1000</span> </li>
                              <li><input id="outside" name="delivery" type="radio" onclick="DeliveryWithout()"> <label for="outside" style="font-size: small;"> Delivery outside Lagos</label> <span style="float: right; color: #16df7e;">₦ 2000</span> </li>
            
                              <li>Total <span style="color: #16df7e; float:right" id="totalId">{{order.get_cart_total}}</span> <span style="color: #16df7e; float:right;">₦&nbsp;</span> </li>
                            </ul>
                          </div>
                        <button style="background-color: #16df7e;" class="site-btn"><a href="https://justpaga.me/thezillianworld" id="pay"  target="_blank" style="color: white;">Make payment</a></button>
                          <h5 style="font-size: small; font-weight:50; margin-top:5px;"><span>Note:</span> Put your unique code in the comment section</h5>
                          <!--div class="checkout__form__input" id="container1" style="visibility: hidden; margin-left:80px;">
                            <label  style="padding-top: 10px; margin-bottom:20px; border-radius:10px; border:none; font-size:large;">3477916807 - Zillian World</label>
                            <h6>Or</h6>
                            <button id="afterpayment" style="border: none; border-radius:10px; margin-bottom: 20px; margin-top: 20px;"><a href="https://justpaga.me/thezillianworld"  target="_blank"
                              style="color: white; background-color: #16df7e; padding:5px; border-radius:10px;">Pay with paga</a></button>
                          </div-->

                          <button style="background-color: #16df7e; visibility:hidden" type="submit" id="submit" class="site-btn">Place oder</button>

                    </div>
                </div>
            </form>
        </div>
    </section>

    <div class="container" style="margin-bottom: 20px;">
        <form action="" method="POST" enctype="multipart/form-data">
          <div class="row">
            <div class="col-lg-4">
              <div class="checkout__order">
                <div class="checkout__form__input">
                  <h5 style="font-size: small; font-weight:200">Make payment and upload your receipt here with your Unique code</h5>

                  {% csrf_token %}
                  {{ form.as_p }}
                </div>
                <button style="background-color: #16df7e;" type="submit" class="site-btn">Upload receipt</button>
              </div>
            </div>
          </div>
        </form>
      </div>


    <footer id="footer">

        <div class="footer-top">

            <div class="container">
                <div class="row  justify-content-center">
                    <div class="col-lg-6">
                      <h3>ZillianWorld</h3>
                      <p>Your satisfaction is our upmost priority. Welcome to the Zillian World.</p>
                    </div>
                  </div>

                <div class="row footer-newsletter justify-content-center">
                    <div class="col-lg-6">
                      <form action="{% url 'subscribe' %}" method="post">
                        {% csrf_token %}
                        <input type="email" name="email" placeholder="Enter your Email"><input type="submit" value="Subscribe">
                      </form>
                    </div>
                  </div>
          
                  <div class="social-links">
                    <a href="https://mobile.twitter.com/thezillianworld" class="twitter"><i class="bx bxl-twitter"></i></a>
                    <a href="#" class="facebook"><i class="bx bxl-facebook"></i></a>
                    <a href="https://instagram.com/thezillianworld" class="instagram"><i class="bx bxl-instagram"></i></a>
                    <a href="https://wa.me/+2348154147595" class="google-plus"><i class="bx bxl-whatsapp"></i></a>
                  </div>

            </div>
        </div>

        <div class="container footer-bottom clearfix">
            <div class="copyright">
                &copy; Copyright <strong><span>ZillianWorld</span></strong>. All Rights Reserved
            </div>
        </div>
    </footer>


    <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'vendor/jquery.easing/jquery.easing.min.js' %}"></script>
    <script src="{% static 'vendor/php-email-form/validate.js' %}"></script>
    <script src="{% static 'vendor/waypoints/jquery.waypoints.min.js' %}"></script>
    <script src="{% static 'vendor/counterup/counterup.min.js' %}"></script>
    <script src="{% static 'vendor/isotope-layout/isotope.pkgd.min.js' %}"></script>
    <script src="{% static 'vendor/venobox/venobox.min.js' %}"></script>
    <script src="{% static 'vendor/owl.carousel/owl.carousel.min.js' %}"></script>


    <script src="{% static 'js/main.js' %}"></script>
    <script src="{% static 'js/aquarium_cart.js' %}"></script>
    <script>
        function Yourself(){
            console.log('Radio clicked');
            number = 0.00;
            var tot = {{order.get_cart_total|floatformat:2}} + number
            tot = tot.toString()
            console.log(tot)
            var totalId = document.getElementById('totalId').textContent = tot;
            document.getElementById('total').value = tot;
            
          };

        function DeliveryWithin(){
          console.log('Radio clicked');
          number = 1000.00;
          var tot = {{order.get_cart_total|floatformat:2}} + number
          tot = tot.toString()
          console.log(tot)
          var totalId = document.getElementById('totalId').textContent = tot;
          document.getElementById('total').value = tot;
          
        };
    
        function DeliveryWithout(){
          console.log('Radio ');
          number = 2000.00;
          var tot = {{order.get_cart_total|floatformat:2}} + number
          tot = tot.toString()
          console.log(tot);
          var totalId = document.getElementById('totalId').textContent = tot;
          document.getElementById('total').value = tot;
          
        }
        
      </script>
    <script>
    document.getElementById('pay').addEventListener('click', function () {
      document.getElementById('submit').style.visibility = 'visible';

    });
  </script>
    <script type="text/javascript">
        var user = '{{request.user}}'

        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        var csrftoken = getCookie('csrftoken');

    </script>
    <script type="text/javascript">
        var shipping = '{{order.shipping}}'
        var tot = document.getElementById('totalId').textContent
        var total =  String(tot)

        if (shipping == 'False') {
            document.getElementById('shipping-info').innerHTML = ""
        };



        var form = document.getElementById('form')
        form.addEventListener('submit', function (e) {
            e.preventDefault()
            console.log('Form Submitted ..')
        });

        document.getElementById('submit').addEventListener('click', function (e) {
            submitFormData()
        });

        function submitFormData() {
            console.log('Payment button clicked')

            var userFormData = {
                'name': null,
                'phone': null,
                'email': null,
                'total': total,
            }

            var shippingInfo = {
                'streetAddress': null,
                'apartmentAddress': null,
                'town': null,
                'state': null,
                'zipcode': null,
                'code': null,
                'subtotal': null,
                'total': null,
            }

            if (shipping != 'False') {
                shippingInfo.streetAddress = form.streetAddress.value
                shippingInfo.apartmentAddress = form.apartmentAddress.value
                shippingInfo.town = form.town.value
                shippingInfo.state = form.state.value
                shippingInfo.zipcode = form.zipcode.value
                shippingInfo.code = form.code.value
                shippingInfo.subtotal = form.subtotal.value
                shippingInfo.total = form.total.value
            }

            if (user == 'AnonymousUser') {
                userFormData.name = form.name.value
                userFormData.phone = form.phone.value
                userFormData.email = form.email.value
            }

            var url = "process_order"
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
                body: JSON.stringify({ 'form': userFormData, 'shipping': shippingInfo }),
            })
                .then((response) => response.json())
                .then((data) => {
                    console.log('Success:', data);
                    alert('Transaction completed');
                    bag = {}
                    document.cookie = 'bag=' + JSON.stringify(bag) + ";domain=;path=/"
                    window.location.href = "{% url 'aquarium_checkout' %}"

                })
        };
    </script>

</body>

</html>